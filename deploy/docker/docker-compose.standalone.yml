version: '3.8'

services:
  novelvoice:
    build:
      context: ../..
      dockerfile: deploy/docker/Dockerfile
    image: skyshenma2024/novelvoice:latest
    container_name: novelvoice
    restart: unless-stopped

    ports:
      - "8000:8000"

    volumes:
      # 数据持久化(必需)
      - ../../data:/data
      # 时区同步
      - /etc/localtime:/etc/localtime:ro

    environment:
      # 基础配置
      - NOVELVOICE_DATA_DIR=/data
      - NOVELVOICE_HOST=0.0.0.0
      - NOVELVOICE_PORT=8000
      # 可选: TTS 配置
      # - NOVELVOICE_TTS_VOICE=zh-CN-XiaoxiaoNeural
      - TZ=America/Los_Angeles
      # 应用版本 (可选, 用于显式覆盖, 默认会自动从 docs/changelog.md 提取)
      # - NOVELVOICE_VERSION=1.3.2
      # - NOVELVOICE_TTS_CONCURRENCY=2

      # 可选: Bark 通知
      # - NOVELVOICE_BARK_ENABLED=true
      # - NOVELVOICE_BARK_API_KEY=your_bark_key_here

    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8000/api/books" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
