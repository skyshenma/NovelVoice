version: '3.8'

# NovelVoice Standalone Deployment
# Use this file to deploy without cloning the repository.
# Simply download this file and run: docker-compose up -d

services:
  novelvoice:
    image: skyshenma2024/novelvoice:latest
    container_name: novelvoice
    restart: unless-stopped

    ports:
      - "8000:8000"

    volumes:
      # Data persistence
      - ./data:/data
      # Timezone Sync
      - /etc/localtime:/etc/localtime:ro

    environment:
      - NOVELVOICE_DATA_DIR=/data
      - NOVELVOICE_DB_DIR=/data/db
      - NOVELVOICE_HOST=0.0.0.0
      - NOVELVOICE_PORT=8000
      - TZ=America/Los_Angeles
      # 应用版本 (可选, 用于显式覆盖, 默认会自动从 docs/changelog.md 提取)
      # - NOVELVOICE_VERSION=1.4.1

    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8000/api/books" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
